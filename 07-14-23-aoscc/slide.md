# 用爱发电见闻录

从纯爱好项目开发及维护引发的思考

black_desk 2024.07.14

---

## Overview

- 自我介绍
- 预防针
- 动机
- 技术选型
- 开发规范
- 测试先行
- 多想多看少动手

---

## 自我介绍

- [github](https://github.com/black-desk)

- https://oier.baoshuo.dev/oier/15583

- [cgtproxy](https://github.com/black-desk/cgtproxy)
  对cgroupfs使用inotify以动态产生nft规则

- [fcitx5-ui.nvim](https://github.com/black-desk/fcitx5-ui.nvim)
  在neovim里画fcitx5的候选词窗口

- [fmtjournal](https://github.com/black-desk/fmtjournal)
  格式化systemd日志

- 贡献过一些奇奇怪怪的项目
  <!-- kernel cmake neovim runc pandoc -->

---

## 预防针

- 以用户态为主
- 兴趣驱动

---

## 动机

- 解决自己遇到的问题
- 积累经验
- 获得成就感

---

## 信心

- 开源项目通常是灵车的
- 有价值的贡献是容易的

---

## 技术选型

- 语言和生态
- 时间估算
- 造轮子？
- 库的质量
  - 用户数量
  - 文档
  - 接口风格
  - 最近更改时间

---

## 开发规范

- 看警告

  <!-- 配linter -->

---

## 开发规范

- 编码习惯

  <!-- 代码应该怎么写 -->

  https://www.youtube.com/@CodeAesthetic
  
  ![](data:image/png;base64,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)

---

## 开发规范

- 设计模式

  灵车的依赖
 
  > refact: switch to github.com/rjeczalik/notify
  >
  > Showing 5 changed files with 32 additions and 171 deletions.
  
  https://github.com/black-desk/cgtproxy/commit/6d51df8c9f9927d2533b80d020fc58f37f099f31

  <!-- 代码应该放在哪个函数里 -->
  <!-- 函数应该放在哪个类里 -->
  <!-- 类之间怎么相互依赖 -->

---

## 开发规范

- 物理结构

  https://book.douban.com/subject/36600646/

  ![](data:image/png;base64,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)

  <!-- 代码的物理结构同样很重要 -->
  <!-- 类应该放在哪个包里 -->
  <!-- 包应该放在什么目录里 -->
  <!-- 目录结构尽可能和语言上的机制对应 -->
  <!-- 最终的分发载体 -->

---

## 测试驱动

- 软件的价值

  <!-- 价值是软件的行为，能解决的问题 -->

- 可测试性
  
  <!-- 可测试性是软件质量的重要指标 -->
  <!-- 1. 正确性有基础保证 -->
  <!-- 2. 有重构空间 -->
  <!-- 3. 解耦 -->

- 开发效率

  <!-- 实际上开发效率是更高的 -->

---

## 多想多看少动手

- 非最佳实践大概率可以工作
- 先找现有方案
- Why/How

<!-- 成就感：分享 -->

---

## 趣事

- pandoc
  
  https://github.com/jgm/pandoc/pull/8142

- google/nftables

  - 一觉睡醒草稿被合并了
  - > ... Could we just remove it instead? (I don’t see any usages on github.com/search) ...

---

Thanks
